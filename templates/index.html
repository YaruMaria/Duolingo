<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathGym - –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –û–ì–≠</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <header class="header">
            <div class="profile-section">
                <div class="avatar">üë§</div>
                <div class="level-badge">–£—Ä. 5</div>
            </div>

            <div class="stats">
                <div class="hearts">
                    {% for i in range(5) %}
                        <span class="heart {% if i < hearts %}active{% else %}inactive{% endif %}">‚ù§Ô∏è</span>
                    {% endfor %}
                </div>
                <div class="gems">
                    üíé <span id="gems-count">{{ gems }}</span>
                </div>
            </div>
        </header>

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div id="notification" class="notification hidden">
            <span id="notification-text"></span>
        </div>

        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä -->
        <div class="progress-section">
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ progress }}%"></div>
            </div>
            <div class="progress-text">{{ progress }}% –∑–∞–≤–µ—Ä—à–µ–Ω–æ</div>
        </div>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–¥—É–ª—è -->
        <div class="module-header">
            <h1>{{ title }}</h1>
            <div class="module-subtitle">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –û–ì–≠ –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ</div>
        </div>

        <!-- –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ —É—Ä–æ–≤–Ω–µ–π –ø–æ —Ü–µ–Ω—Ç—Ä—É -->
        <div class="vertical-roadmap">
            {% for level in levels %}
            <div class="level-path">
                <!-- –°–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–∏–Ω–∏—è -->
                {% if not loop.first %}
                <div class="connection-line {% if level.completed %}completed{% elif not level.locked and levels[loop.index-2].completed %}available{% endif %}"></div>
                {% endif %}

                <!-- –£—Ä–æ–≤–µ–Ω—å -->
                <div class="level-wrapper">
                    <div class="level-node {% if level.completed %}completed{% elif level.locked %}locked{% else %}available{% endif %}"
                         data-level="{{ level.number }}"
                         onclick="handleLevelClick({{ level.number }}, '{{ level.type }}')">

                        <div class="level-icon">
                            {% if level.type == 'book' %}üìö{% endif %}
                            {% if level.type == 'brain' %}üß†{% endif %}
                            {% if level.type == 'practice' %}‚úèÔ∏è{% endif %}
                            {% if level.type == 'test' %}üìù{% endif %}
                            {% if level.type == 'repeat' %}üîÑ{% endif %}
                            {% if level.type == 'exam' %}üéØ{% endif %}
                        </div>

                        <div class="level-number">{{ level.number }}</div>

                        {% if level.completed %}
                        <div class="level-stars">
                            {% for i in range(3) %}
                                <span class="star {% if i < level.stars %}filled{% endif %}">‚≠ê</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞—á–∞–ª–∞ -->
        <div class="start-section">
            <button class="start-button" onclick="startLesson()">–ù–ê–ß–ê–¢–¨ –ü–£–¢–ï–®–ï–°–¢–í–ò–ï</button>
        </div>

        <!-- –¢–µ—Å—Ç–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ -->
        <div class="test-buttons">
            <button class="test-button" onclick="loseHeart()">üíî –ü–æ—Ç–µ—Ä—è—Ç—å —Å–µ—Ä–¥—Ü–µ</button>
            <button class="test-button" onclick="addGems()">üí∞ –î–æ–±–∞–≤–∏—Ç—å —Å–∞–º–æ—Ü–≤–µ—Ç—ã</button>
            <button class="test-button" onclick="completeCurrentLevel()">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å</button>
        </div>

        <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="bottom-nav">
            <a href="#" class="nav-item active">üè†</a>
            <a href="#" class="nav-item">üìä</a>
            <a href="#" class="nav-item">üë•</a>
            <a href="#" class="nav-item">üèÜ</a>
            <a href="#" class="nav-item">‚öôÔ∏è</a>
        </nav>
    </div>

    <script>
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');

            notificationText.textContent = message;
            notification.className = `notification ${type} show`;

            setTimeout(() => {
                notification.className = 'notification hidden';
            }, 3000);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å
        function handleLevelClick(levelNumber, levelType) {
            if (levelType === 'book') {
                // –ï—Å–ª–∏ —ç—Ç–æ "–ù–æ–≤–∞—è —Ç–µ–º–∞" - –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å —Ç–µ–º–∞–º–∏ –û–ì–≠
                window.location.href = '/math_topics';
            } else {
                // –î–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ —É—Ä–æ–≤–Ω–µ–π - –æ–±—ã—á–Ω–∞—è –ª–æ–≥–∏–∫–∞
                playLevel(levelNumber);
            }
        }

        function startLesson() {
            fetch('/start_lesson')
                .then(response => response.json())
                .then(data => {
                    showNotification(data.message, 'success');
                })
                .catch(error => {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —É—Ä–æ–∫–∞', 'error');
                });
        }

        function playLevel(levelNumber) {
            fetch(`/play_level/${levelNumber}`)
                .then(response => response.json())
                .then(data => {
                    showNotification(data.message, data.action === 'level_started' ? 'success' : 'error');
                })
                .catch(error => {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —É—Ä–æ–≤–Ω—è', 'error');
                });
        }

        function completeCurrentLevel() {
            const availableLevels = document.querySelectorAll('.level-node.available');
            if (availableLevels.length > 0) {
                const levelNumber = availableLevels[0].getAttribute('data-level');
                completeLevel(levelNumber);
            } else {
                showNotification('‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è', 'error');
            }
        }

        function completeLevel(levelNumber) {
            fetch(`/complete_level/${levelNumber}`)
                .then(response => response.json())
                .then(data => {
                    if (response.ok) {
                        showNotification(data.message, 'success');
                        document.getElementById('gems-count').textContent = data.gems;
                        setTimeout(() => location.reload(), 1500);
                    } else {
                        showNotification(data.message, 'error');
                    }
                })
                .catch(error => {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è', 'error');
                });
        }

        function loseHeart() {
            fetch('/lose_heart')
                .then(response => response.json())
                .then(data => {
                    if (response.ok) {
                        showNotification(data.message, 'warning');
                        setTimeout(() => location.reload(), 1500);
                    } else {
                        showNotification(data.message, 'error');
                    }
                })
                .catch(error => {
                    showNotification('–û—à–∏–±–∫–∞', 'error');
                });
        }

        function addGems() {
            fetch('/add_gems')
                .then(response => response.json())
                .then(data => {
                    showNotification(data.message, 'success');
                    document.getElementById('gems-count').textContent = data.gems;
                })
                .catch(error => {
                    showNotification('–û—à–∏–±–∫–∞', 'error');
                });
        }

        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                showNotification(`–ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–∞–∑–¥–µ–ª: ${this.textContent}`, 'info');
            });
        });
    </script>
</body>
</html>